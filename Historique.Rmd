---
title: "Historique"
author: "Marie"
date: "2024-02-27"
output: html_document
---

# Comparaison avec l'année 2019

## Programmes

### Importation des données

On importe d'abord les données de la calculette actualisée

```{r warning = FALSE}
BUCKET <- "marieguibert2"
FILE_KEY_S3 <- "202402-MAJ_Referentiels/Fichiers_traites/Calculette_Chorus_2024-02-07_actualisee.xlsx"

prog <- 
  aws.s3::s3read_using(
    FUN = readxl::read_excel,
    sheet = "03 - Programmes",
    skip = 8,
    col_types = c("text", "text", "text", "text", "date", "date", "text", "text"),
    object = FILE_KEY_S3,
    bucket = BUCKET,
    opts = list("region" = "")
  )



prog$`Date validité Début` <- format(prog$`Date validité Début`, "%d-%m-%Y")
prog$`Date validité Fin` <- format(prog$`Date validité Fin`, "%d-%m-%Y")

head(prog, 10)
```

```{r}
FILE_KEY_S3 <- "202402-MAJ_Referentiels/Historique/xlsxCalculette_Chorus_2019-12-01.xlsx"

prog2019 <- 
  aws.s3::s3read_using(
    FUN = readxl::read_excel,
    sheet = "03 - Programmes",
    skip = 8,
    object = FILE_KEY_S3,
    bucket = BUCKET,
    opts = list("region" = "")
  )

head(prog2019, 10)
```

### Analyse des référentiels

On analyse si notre référentiel est complet par rapport à 2019

```{r}
length(intersect(prog2019$`Code Programme`, prog$`Code Programme`)) # Nombre de programmes en commun
length(setdiff(prog2019$`Code Programme`, prog$`Code Programme`)) # Nombre de programmes différents
```

On remarque 13 programmes avec des codes différents entre les deux fichiers

```{r}
length(intersect(prog2019$Intitulé, prog$Intitulé)) # Nombre de programmes en commun
length(setdiff(prog2019$Intitulé, prog$Intitulé)) # Nombre de programmes différents
```

Cependant, on a 61 intitulés différents. Cela signifie que certains programmes ont été renommés ou complétés : on décide donc de garder les noms les plus récents pour avoir la dénomination la plus à jour possible

### Mise à jour du référentiel        

Pour savoir de quelle année provient chaque programme / nom de programme, on ajoute une colonne année à chaque fichier (pour les graphiques ensuite)


```{r}
prog$annee <- "2024"
head(prog)
```

```{r}
prog2019$annee <- "2019"
head(prog2019)
```

On fait ensuite une jointure sur le code pour mettre à jour le référentiel 

```{r}

```



























